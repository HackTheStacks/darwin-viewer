{"version":3,"sources":["image-model.es6"],"names":[],"mappings":";;;;;;;;;;IAAM,c;AACF,4BAAY,UAAZ,EAAwB;AAAA;;AACpB,aAAK,UAAL,GAAkB,IAAlB;AACA,aAAK,WAAL,GAAmB,IAAI,KAAJ,EAAnB;AACA,aAAK,SAAL,GAAiB,WAAW,GAAX,CAAe,CAAf,CAAjB;AACA,aAAK,WAAL,CAAiB,GAAjB,GAAuB,UAAU,GAAjC;AACA,aAAK,MAAL,GAAc,SAAS,aAAT,CAAuB,QAAvB,CAAd;;AAEA,aAAK,KAAL,GAAa,EAAb;AACA,aAAK,SAAL,GAAiB,IAAjB;AACA,aAAK,QAAL,GAAgB,EAAhB;AACA,aAAK,SAAL,GAAiB,EAAjB;AACA,aAAK,QAAL,GAAgB,GAAhB;AACA,aAAK,SAAL,GAAiB,GAAjB;;AAGR;AACQ,UAAE,UAAF,EAAc,IAAd,CAAmB,sCAAnB,EACK,MADL,CACY,sDADZ,EAEK,MAFL,CAEY,sDAFZ,EAGK,KAHL,CAGW,sDAHX,EAIK,KAJL,CAIW,sDAJX;;AAMA;AACA,aAAK,UAAL,GAAkB,EAAE,UAAF,EAAc,MAAd,CAAqB,mBAArB,CAAlB;AACA,aAAK,UAAL,CAAgB,EAAhB,CAAmB,sBAAnB,EAA2C,gBAA3C,EAA6D,KAAK,WAAlE;AACA,aAAK,UAAL,CAAgB,EAAhB,CAAmB,sBAAnB,EAA2C,KAA3C,EAAkD,KAAK,WAAvD;AACH;;AAGD;;;;oCAEY,C,EAAG;AACX,oBAAQ,GAAR,CAAY,eAAZ;AACA,cAAE,cAAF;AACA,cAAE,eAAF;AACA,iBAAK,cAAL,CAAoB,CAApB;AACA,cAAE,QAAF,EAAY,EAAZ,CAAe,qBAAf,EAAsC,KAAK,QAA3C;AACA,cAAE,QAAF,EAAY,EAAZ,CAAe,kBAAf,EAAmC,KAAK,SAAxC;AACH;;;kCAES,C,EAAG;AACT,oBAAQ,GAAR,CAAY,aAAZ;AACA,cAAE,cAAF;AACA,cAAE,QAAF,EAAY,GAAZ,CAAgB,kBAAhB,EAAoC,KAAK,SAAzC;AACA,cAAE,QAAF,EAAY,GAAZ,CAAgB,qBAAhB,EAAuC,KAAK,QAA5C;AACH;;;uCAEc,C,EAAG;AAAA;;AACd,oBAAQ,GAAR,CAAY,aAAZ;AACA;AACA,iBAAK,KAAL,CAAW,cAAX,GAA4B,KAAK,UAAL,CAAgB,KAAhB,EAA5B;AACA,iBAAK,KAAL,CAAW,eAAX,GAA6B,KAAK,UAAL,CAAgB,MAAhB,EAA7B;AACA,iBAAK,KAAL,CAAW,aAAX,GAA2B,KAAK,UAAL,CAAgB,MAAhB,GAAyB,IAApD;AACA,iBAAK,KAAL,CAAW,YAAX,GAA0B,KAAK,UAAL,CAAgB,MAAhB,GAAyB,GAAnD;AACA,iBAAK,KAAL,CAAW,MAAX,GAAoB,CAAC,EAAE,OAAF,IAAa,EAAE,KAAf,IAAwB,EAAE,aAAF,CAAgB,OAAhB,CAAwB,CAAxB,EAA2B,OAApD,IAA+D,EAAE,MAAF,EAAU,UAAV,EAAnF;AACA,iBAAK,KAAL,CAAW,MAAX,GAAoB,CAAC,EAAE,OAAF,IAAa,EAAE,KAAf,IAAwB,EAAE,aAAF,CAAgB,OAAhB,CAAwB,CAAxB,EAA2B,OAApD,IAA+D,EAAE,MAAF,EAAU,SAAV,EAAnF;;AAEA;AACA;AACA,gBAAI,OAAO,EAAE,aAAF,CAAgB,OAAvB,KAAmC,WAAvC,EAAoD;AAChD,qBAAK,KAAL,CAAW,OAAX,GAAqB,EAArB;AACA,kBAAE,IAAF,CAAO,EAAE,aAAF,CAAgB,OAAvB,EAAgC,UAAC,CAAD,EAAI,EAAJ,EAAW;AACvC,0BAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB,IAAwB,EAAxB;AACA,0BAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB,EAAsB,OAAtB,GAAgC,IAAI,GAAG,OAAvC;AACA,0BAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB,EAAsB,OAAtB,GAAgC,IAAI,GAAG,OAAvC;AACH,iBAJD;AAKH;AACD,iBAAK,KAAL,CAAW,KAAX,GAAmB,CAAnB;AACH;;;iCAEQ,C,EAAG;AACR,oBAAQ,GAAR,CAAY,WAAZ,EAAyB,EAAE,MAAM,KAAN,CAAY,MAAd,CAAzB;AACA,gBAAI,QAAQ,EAAZ;AAAA,gBACI,cADJ;AAAA,gBAEI,eAFJ;AAAA,gBAGI,aAHJ;AAAA,gBAII,YAJJ;AAAA,gBAKI,SAAS,KAAK,UAAL,CAAgB,MAAhB,EALb;;AAOA,kBAAM,CAAN,GAAU,CAAC,EAAE,OAAF,IAAa,EAAE,KAAf,IAAwB,EAAE,aAAF,CAAgB,OAAhB,CAAwB,CAAxB,EAA2B,OAApD,IAA+D,EAAE,MAAF,EAAU,UAAV,EAAzE;AACA,kBAAM,CAAN,GAAU,CAAC,EAAE,OAAF,IAAa,EAAE,KAAf,IAAwB,EAAE,aAAF,CAAgB,OAAhB,CAAwB,CAAxB,EAA2B,OAApD,IAA+D,EAAE,MAAF,EAAU,SAAV,EAAzE;;AAEA,oBAAQ,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,aAA7B;AACA,qBAAS,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,YAA9B;AACA,mBAAO,KAAK,KAAL,CAAW,aAAlB;AACA,kBAAM,KAAK,KAAL,CAAW,YAAjB;;AAEA;AACA,gBAAI,EAAE,KAAK,KAAL,CAAW,KAAX,CAAiB,MAAnB,EAA2B,QAA3B,CAAoC,kBAApC,CAAJ,EAA6D;AACzD,wBAAQ,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,aAA7B;AACA,yBAAS,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,YAA9B;AACA,uBAAO,KAAK,KAAL,CAAW,aAAlB;AACA,sBAAM,KAAK,KAAL,CAAW,YAAjB;AACH,aALD,MAKO,IAAI,EAAE,KAAK,KAAL,CAAW,KAAX,CAAiB,MAAnB,EAA2B,QAA3B,CAAoC,kBAApC,CAAJ,EAA6D;AAChE,wBAAQ,KAAK,KAAL,CAAW,cAAX,IAA6B,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,aAAlD,CAAR;AACA,yBAAS,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,YAA9B;AACA,uBAAO,MAAM,CAAb;AACA,sBAAM,KAAK,KAAL,CAAW,YAAjB;AACH,aALM,MAKA,IAAI,EAAE,KAAK,KAAL,CAAW,KAAX,CAAiB,MAAnB,EAA2B,QAA3B,CAAoC,kBAApC,CAAJ,EAA6D;AAChE,wBAAQ,KAAK,KAAL,CAAW,cAAX,IAA6B,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,aAAlD,CAAR;AACA,yBAAS,KAAK,KAAL,CAAW,eAAX,IAA8B,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,YAAnD,CAAT;AACA,uBAAO,MAAM,CAAb;AACA,sBAAM,MAAM,CAAZ;AACA,oBAAI,KAAK,SAAL,IAAkB,EAAE,QAAxB,EAAkC;AAC9B,0BAAM,MAAM,CAAN,IAAY,QAAQ,KAAK,WAAL,CAAiB,KAAzB,GAAiC,KAAK,WAAL,CAAiB,MAAnD,GAA6D,MAAxE,CAAN;AACH;AACJ,aARM,MAQA,IAAI,EAAE,KAAK,KAAL,CAAW,KAAX,CAAiB,MAAnB,EAA2B,QAA3B,CAAoC,kBAApC,CAAJ,EAA6D;AAChE,wBAAQ,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,aAA7B;AACA,yBAAS,KAAK,KAAL,CAAW,eAAX,IAA8B,MAAM,CAAN,GAAU,KAAK,KAAL,CAAW,YAAnD,CAAT;AACA,uBAAO,KAAK,KAAL,CAAW,aAAlB;AACA,sBAAM,MAAM,CAAZ;AACA,oBAAI,aAAa,EAAE,QAAnB,EAA6B;AACzB,0BAAM,MAAM,CAAN,IAAY,QAAQ,KAAK,WAAL,CAAiB,KAAzB,GAAiC,KAAK,WAAL,CAAiB,MAAnD,GAA6D,MAAxE,CAAN;AACH;AACJ;;AAED,gBAAI,KAAK,SAAL,IAAkB,EAAE,QAAxB,EAAkC;AAC9B,yBAAS,QAAQ,KAAK,WAAL,CAAiB,KAAzB,GAAiC,KAAK,WAAL,CAAiB,MAA3D;AACH;;AAED,gBAAI,QAAQ,KAAK,QAAb,IAAyB,SAAS,KAAK,SAAvC,IAAoD,QAAQ,KAAK,QAAjE,IAA6E,SAAS,KAAK,SAA/F,EAA0G;AACtG,wBAAQ,GAAR,CAAY,mBAAZ;AACA,qBAAK,WAAL,CAAiB,KAAjB,EAAwB,MAAxB;AACA;AACA,qBAAK,UAAL,CAAgB,MAAhB,CAAuB,EAAC,QAAQ,IAAT,EAAe,OAAO,GAAtB,EAAvB;AACH;AACJ;;;oCAEW,K,EAAO,M,EAAQ;AACvB,oBAAQ,GAAR,CAAY,cAAZ;AACA,iBAAK,MAAL,CAAY,KAAZ,GAAoB,KAApB;AACA,iBAAK,MAAL,CAAY,MAAZ,GAAqB,MAArB;AACA,iBAAK,MAAL,CAAY,UAAZ,CAAuB,IAAvB,EAA6B,SAA7B,CAAuC,KAAK,WAA5C,EAAyD,CAAzD,EAA4D,CAA5D,EAA+D,KAA/D,EAAsE,MAAtE;AACA,cAAE,KAAK,SAAP,EAAkB,IAAlB,CAAuB,KAAvB,EAA8B,KAAK,MAAL,CAAY,SAAZ,CAAsB,WAAtB,CAA9B;AACH;;;oCAEW,C,EAAG;AACX,cAAE,cAAF;AACA,cAAE,eAAF;AACA,iBAAK,cAAL,CAAoB,CAApB;AACA,cAAE,QAAF,EAAY,EAAZ,CAAe,qBAAf,EAAsC,KAAK,MAA3C;AACA,cAAE,QAAF,EAAY,EAAZ,CAAe,kBAAf,EAAmC,KAAK,SAAxC;AACH;;;kCAES,C,EAAG;AACT,cAAE,cAAF;AACA,cAAE,QAAF,EAAY,GAAZ,CAAgB,kBAAhB,EAAoC,KAAK,SAAzC;AACA,cAAE,QAAF,EAAY,GAAZ,CAAgB,qBAAhB,EAAuC,KAAK,MAA5C;AACH;;;+BAEM,C,EAAG;AACN,gBAAI,QAAQ,EAAZ;AACA,cAAE,cAAF;AACA,cAAE,eAAF;;AAEA,gBAAI,UAAU,EAAE,aAAF,CAAgB,OAA9B;;AAEA,kBAAM,CAAN,GAAU,CAAC,EAAE,OAAF,IAAa,EAAE,KAAf,IAAwB,QAAQ,CAAR,EAAW,OAApC,IAA+C,EAAE,MAAF,EAAU,UAAV,EAAzD;AACA,kBAAM,CAAN,GAAU,CAAC,EAAE,OAAF,IAAa,EAAE,KAAf,IAAwB,QAAQ,CAAR,EAAW,OAApC,IAA+C,EAAE,MAAF,EAAU,SAAV,EAAzD;;AAEA,iBAAK,UAAL,CAAgB,MAAhB,CAAuB;AACnB,wBAAQ,MAAM,CAAN,IAAY,KAAK,KAAL,CAAW,MAAX,GAAoB,KAAK,KAAL,CAAW,aAA3C,CADW;AAEnB,uBAAO,MAAM,CAAN,IAAY,KAAK,KAAL,CAAW,MAAX,GAAoB,KAAK,KAAL,CAAW,YAA3C;AAFY,aAAvB;;AAKA;AACA,gBAAI,KAAK,KAAL,CAAW,OAAX,IAAsB,KAAK,KAAL,CAAW,OAAX,CAAmB,MAAnB,GAA4B,CAAlD,IAAuD,QAAQ,MAAR,GAAiB,CAA5E,EAA+E;AAC3E,oBAAI,QAAQ,KAAK,KAAL,CAAW,cAAvB;AAAA,oBACI,SAAS,KAAK,KAAL,CAAW,eADxB;AAEA,oBAAI,IAAI,KAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB,EAAsB,OAAtB,GAAgC,KAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB,EAAsB,OAA9D;AACA,oBAAI,IAAI,CAAR;AACA,oBAAI,IAAI,KAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB,EAAsB,OAAtB,GAAgC,KAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB,EAAsB,OAA9D;AACA,oBAAI,IAAI,CAAR;AACA,oBAAI,QAAQ,KAAK,IAAL,CAAU,IAAI,CAAd,CAAZ;;AAEA,oBAAI,EAAE,aAAF,CAAgB,OAAhB,CAAwB,CAAxB,EAA2B,OAA3B,GAAqC,QAAQ,CAAR,EAAW,OAApD;AACA,oBAAI,IAAI,CAAR;AACA,oBAAI,EAAE,aAAF,CAAgB,OAAhB,CAAwB,CAAxB,EAA2B,OAA3B,GAAqC,QAAQ,CAAR,EAAW,OAApD;AACA,oBAAI,IAAI,CAAR;AACA,oBAAI,QAAQ,KAAK,IAAL,CAAU,IAAI,CAAd,CAAZ;;AAEA,oBAAI,QAAQ,QAAQ,KAApB;;AAEA,wBAAQ,QAAQ,KAAhB;AACA,yBAAS,SAAS,KAAlB;AACA;AACA,qBAAK,WAAL,CAAiB,KAAjB,EAAwB,MAAxB;AACH;AACJ;;;;;;kBAGU,c","file":"image-model.js","sourcesContent":["class ResizableImage {\n    constructor($targetImg) {\n        this.$container = null;\n        this.originalImg = new Image();\n        this.targetImg = $targetImg.get(0);\n        this.originalImg.src = targetImg.src;\n        this.canvas = document.createElement('canvas');\n\n        this.state = {};\n        this.constrain = true;\n        this.minWidth = 60;\n        this.minHeight = 60;\n        this.maxWidth = 800;\n        this.maxHeight = 800;\n\n\n// Add resize handles\n        $($targetImg).wrap('<div class=\"resize-container\"></div>')\n            .before('<span class=\"resize-handle resize-handle-nw\"></span>')\n            .before('<span class=\"resize-handle resize-handle-ne\"></span>')\n            .after('<span class=\"resize-handle resize-handle-se\"></span>')\n            .after('<span class=\"resize-handle resize-handle-sw\"></span>');\n\n        // Get a variable for the container\n        this.$container = $($targetImg).parent('.resize-container');\n        this.$container.on('mousedown touchstart', '.resize-handle', this.startResize);\n        this.$container.on('mousedown touchstart', 'img', this.startMoving);\n    }\n\n\n    // Add events\n\n    startResize(e) {\n        console.log('start resize!');\n        e.preventDefault();\n        e.stopPropagation();\n        this.saveEventState(e);\n        $(document).on('mousemove touchmove', this.resizing);\n        $(document).on('mouseup touchend', this.endResize);\n    }\n\n    endResize(e) {\n        console.log('end resize!');\n        e.preventDefault();\n        $(document).off('mouseup touchend', this.endResize);\n        $(document).off('mousemove touchmove', this.resizing);\n    }\n\n    saveEventState(e) {\n        console.log('save state!');\n        // Save the initial event details and container state\n        this.state.containerWidth = this.$container.width();\n        this.state.containerHeight = this.$container.height();\n        this.state.containerLeft = this.$container.offset().left;\n        this.state.containerTop = this.$container.offset().top;\n        this.state.mouseX = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft();\n        this.state.mouseY = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop();\n\n        // This is a fix for mobile safari\n        // For some reason it does not allow a direct copy of the touches property\n        if (typeof e.originalEvent.touches !== 'undefined') {\n            this.state.touches = [];\n            $.each(e.originalEvent.touches, (i, ob) => {\n                this.state.touches[i] = {};\n                this.state.touches[i].clientX = 0 + ob.clientX;\n                this.state.touches[i].clientY = 0 + ob.clientY;\n            });\n        }\n        this.state.event = e;\n    }\n\n    resizing(e) {\n        console.log('resizing!', $(state.event.target));\n        let mouse = {},\n            width,\n            height,\n            left,\n            top,\n            offset = this.$container.offset();\n\n        mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft();\n        mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop();\n\n        width = mouse.x - this.state.containerLeft;\n        height = mouse.y - this.state.containerTop;\n        left = this.state.containerLeft;\n        top = this.state.containerTop;\n\n        // Position image differently depending on the corner dragged and constraints\n        if ($(this.state.event.target).hasClass('resize-handle-se')) {\n            width = mouse.x - this.state.containerLeft;\n            height = mouse.y - this.state.containerTop;\n            left = this.state.containerLeft;\n            top = this.state.containerTop;\n        } else if ($(this.state.event.target).hasClass('resize-handle-sw')) {\n            width = this.state.containerWidth - (mouse.x - this.state.containerLeft);\n            height = mouse.y - this.state.containerTop;\n            left = mouse.x;\n            top = this.state.containerTop;\n        } else if ($(this.state.event.target).hasClass('resize-handle-nw')) {\n            width = this.state.containerWidth - (mouse.x - this.state.containerLeft);\n            height = this.state.containerHeight - (mouse.y - this.state.containerTop);\n            left = mouse.x;\n            top = mouse.y;\n            if (this.constrain || e.shiftKey) {\n                top = mouse.y - ((width / this.originalImg.width * this.originalImg.height) - height);\n            }\n        } else if ($(this.state.event.target).hasClass('resize-handle-ne')) {\n            width = mouse.x - this.state.containerLeft;\n            height = this.state.containerHeight - (mouse.y - this.state.containerTop);\n            left = this.state.containerLeft;\n            top = mouse.y;\n            if (constrain || e.shiftKey) {\n                top = mouse.y - ((width / this.originalImg.width * this.originalImg.height) - height);\n            }\n        }\n\n        if (this.constrain || e.shiftKey) {\n            height = width / this.originalImg.width * this.originalImg.height;\n        }\n\n        if (width > this.minWidth && height > this.minHeight && width < this.maxWidth && height < this.maxHeight) {\n            console.log('call resize image');\n            this.resizeImage(width, height);\n            // Without this Firefox will not re-calculate the the image dimensions until drag end\n            this.$container.offset({'left': left, 'top': top});\n        }\n    }\n\n    resizeImage(width, height) {\n        console.log('resizeImage!');\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.canvas.getContext('2d').drawImage(this.originalImg, 0, 0, width, height);\n        $(this.targetImg).attr('src', this.canvas.toDataURL(\"image/png\"));\n    }\n\n    startMoving(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.saveEventState(e);\n        $(document).on('mousemove touchmove', this.moving);\n        $(document).on('mouseup touchend', this.endMoving);\n    }\n\n    endMoving(e) {\n        e.preventDefault();\n        $(document).off('mouseup touchend', this.endMoving);\n        $(document).off('mousemove touchmove', this.moving);\n    }\n\n    moving(e) {\n        let mouse = {};\n        e.preventDefault();\n        e.stopPropagation();\n\n        let touches = e.originalEvent.touches;\n\n        mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft();\n        mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop();\n\n        this.$container.offset({\n            'left': mouse.x - ( this.state.mouseX - this.state.containerLeft ),\n            'top': mouse.y - ( this.state.mouseY - this.state.containerTop )\n        });\n\n        // Watch for pinch zoom gesture while moving\n        if (this.state.touches && this.state.touches.length > 1 && touches.length > 1) {\n            var width = this.state.containerWidth,\n                height = this.state.containerHeight;\n            var a = this.state.touches[0].clientX - this.state.touches[1].clientX;\n            a = a * a;\n            var b = this.state.touches[0].clientY - this.state.touches[1].clientY;\n            b = b * b;\n            var dist1 = Math.sqrt(a + b);\n\n            a = e.originalEvent.touches[0].clientX - touches[1].clientX;\n            a = a * a;\n            b = e.originalEvent.touches[0].clientY - touches[1].clientY;\n            b = b * b;\n            var dist2 = Math.sqrt(a + b);\n\n            var ratio = dist2 / dist1;\n\n            width = width * ratio;\n            height = height * ratio;\n            // To improve performance you might limit how often resizeImage() is called\n            this.resizeImage(width, height);\n        }\n    }\n}\n\nexport default ResizableImage;"]}